import pandas as pd

def calculate_reflexivity_score(df):
    """
    Compute the extended reflexivity score:
    reflexivity_score = iv_z + skew_z + tau_weight + price_gap_score + volume_spike_score
    """
    for col in ["iv_z", "skew_z", "tau_weight", "price_gap_score", "volume_spike_score"]:
        if col not in df.columns:
            df[col] = 0
        else:
            df[col] = df[col].fillna(0)

    df["reflexivity_score_v2_extended"] = (
        df["iv_z"] +
        df["skew_z"] +
        df["tau_weight"] +
        df["price_gap_score"] +
        df["volume_spike_score"]
    )

    return df
